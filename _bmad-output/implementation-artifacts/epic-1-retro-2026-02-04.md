# Epic 1 Retrospective — Project Foundation & Public Portal

**Date:** 2026-02-04
**Facilitator:** Bob (Scrum Master)
**Epic:** Epic 1 — Project Foundation & Public Portal (4 stories)
**Status:** Complete (4/4 stories done)

---

## Team Participants

- Alice (Product Owner)
- Bob (Scrum Master — facilitating)
- Charlie (Senior Dev)
- Dana (QA Engineer)
- Elena (Junior Dev)
- Jiraw (Project Lead)

---

## Epic Summary & Metrics

### Delivery

- **Stories Completed:** 4/4 (100%)
  - 1-1: Project Initialization & CI/CD Foundation
  - 1-2: Database Schema & Seed Data
  - 1-3: Public Landing Page with DxT Branding
  - 1-4: Testing Infrastructure, Error Boundaries & Shared Utilities
- **All stories:** Implemented, code reviewed, fixes applied, marked done

### Quality

- **Code review issues found:** 32 total
  - Story 1.1: 9 issues (3 HIGH, 4 MEDIUM, 2 LOW)
  - Story 1.2: 8 issues (3 HIGH, 3 MEDIUM, 2 LOW)
  - Story 1.3: 10 issues (3 HIGH, 4 MEDIUM, 3 LOW)
  - Story 1.4: 5 issues (1 HIGH, 4 MEDIUM)
- **All 32 issues:** Fixed before marking stories done
- **Unit tests:** 96 tests passing (final state)
- **Coverage:** 100% statements/functions/lines, 83% branches on critical path code (`src/lib/`)
- **Production incidents:** 0

### Business Outcomes

- Public landing page live with DxT branding (ISR, RSC, zero client-side JS)
- Database schema with RLS policies and seed data (5 systems, 3 content sections, Super Admin)
- Full CI/CD pipeline (GitHub Actions + Vercel auto-deploy + Husky pre-commit)
- Testing infrastructure (Vitest, Playwright, jest-axe, fast-check, 80% coverage thresholds)
- Shared utilities (toCamelCase/toSnakeCase, API client, error codes, WebSocket event types)

---

## Successes & Strengths

1. **100% story completion** — all 4 stories delivered, reviewed, and done
2. **Strong testing foundation** — 96 unit tests, property-based testing, accessibility testing baked in from day one
3. **Clean architecture patterns** — transform utilities, API client with `{ data, error }` wrapper, centralized error codes, Zod schemas with inferred types
4. **Zero client-side JS on landing page** — RSC + ISR pattern delivers excellent performance
5. **Code review discipline** — every issue resolved before marking done; no shortcuts
6. **Excellent story documentation** — Dev Notes, Debug Logs, File Lists enable cross-story knowledge transfer
7. **Adaptability** — Dev Agent handled unexpected changes (Next.js 16 conventions, Tailwind v4, Sentry deprecations) gracefully

---

## Challenges & Growth Areas

### 1. Planning Doc Technology Drift (HIGH IMPACT)

Architecture document referenced outdated technology versions:
- Tailwind v3 (`tailwind.config.ts`) → actual: Tailwind v4 (CSS-based `@theme`)
- Next.js 14 (`middleware.ts`) → actual: Next.js 16 (`proxy.ts`)
- Supabase `ANON_KEY` → actual: `PUBLISHABLE_KEY`
- Zod v3 → actual: Zod v4

**Impact:** Caused significant rework in Story 1.1, contributed to 9 code review issues. The Dev Agent had to discover and adapt to differences mid-implementation.

### 2. High Code Review Issue Volume

32 issues across 4 stories (avg 8/story). While all were fixed, many were preventable:
- File List documentation gaps (3/4 stories)
- Data boundary violations — snake_case leaking into components (2/4 stories)
- Accessibility gaps — missing `focus-visible`, `aria-label` (2/4 stories)
- Zod schemas defined but not `.parse()`d at runtime (1/4 stories)

### 3. Data Boundary Violations

snake_case→camelCase transformation boundary was violated in Stories 1.2 and 1.3:
- `footerContentSchema` leaked `contact_email` (snake_case) into components
- Manual field mapping instead of using shared transform utility (fixed in 1.4)

### 4. Zod Schemas Without Runtime Validation

Story 1.3 defined `systemSchema` but never called `.parse()` on query results. Type safety existed at compile time but not at runtime. Code review caught it.

### 5. Accessibility as Afterthought

Stories 1.1 and 1.3 had interactive elements (links, buttons) missing `focus-visible:ring-2` indicators and `aria-label` attributes. Fixed in code review, but should have been first-pass requirements.

### 6. Bundle Size Budget Increase

JS size-limit increased from 150KB to 200KB to accommodate Sentry SDK. Architecture specified 150KB. This is tracked technical debt.

### 7. Platform Artifacts

Windows `nul` file appeared in repo in both Stories 1.1 and 1.2. Minor but recurring.

---

## Key Insights & Learnings

1. **Planning docs must stay aligned with actual technology versions.** Version drift caused the highest volume of code review issues. A pre-epic technology audit would prevent this.

2. **Data boundary discipline is a recurring trap.** snake_case→camelCase transformation must happen ONLY in `src/lib/{domain}/queries.ts` files. Nowhere else. The shared `toCamelCase` utility (Story 1.4) is the single source of truth.

3. **Zod schemas without `.parse()` calls are bugs, not features.** If a schema is imported but never validated at runtime, it provides false type safety. Every query function must `.parse()`.

4. **Accessibility must be a first-pass requirement.** Adding `focus-visible`, `aria-label`, keyboard navigation, and ARIA attributes should be part of initial implementation, not code review fixes.

5. **Cross-story knowledge transfer via Dev Notes works well.** Story 1.2 referenced 1.1 learnings, 1.3 referenced 1.2, 1.4 referenced all previous. This pattern should continue.

6. **Server Component testing patterns are established.** Mock `@/lib/supabase/server` at module level, call components as async functions, use `render()` only when jest-axe needs DOM.

---

## Previous Retrospective Follow-Through

N/A — This is the first retrospective (Epic 1).

---

## Next Epic Preview — Epic 2: Authentication & Access Control

### Overview

6 stories covering login, TOTP MFA, backup codes, session management, logout, and RBAC route protection.

### Dependencies on Epic 1

| Dependency | Status |
|---|---|
| Super Admin seeded (Story 1.2) | Done |
| Supabase client patterns (Story 1.1) | Done |
| Error codes & API client (Story 1.4) | Done |
| proxy.ts placeholder (Story 1.1) | Done |
| Upstash Redis installed | Done (not configured) |

### Concerns Identified

- Next.js 16 `proxy.ts` vs `middleware.ts` — route protection patterns need research
- Supabase Auth MFA API (`enrollMFA`, `challengeMFA`, `verifyMFA`) needs investigation
- Auth testing patterns (mock Supabase Auth, test MFA flows) to be established
- Upstash Redis needs provisioning for rate limiting

---

## Action Items

### Process Improvements

| # | Action | Owner | Deadline | Success Criteria |
|---|--------|-------|----------|-----------------|
| P1 | Verify technology versions before each epic starts | SM (Bob) + Dev (Amelia) | Before Epic 2 Story 2.1 creation | Architecture doc checked against installed versions; drift documented in story Dev Notes |
| P2 | Add File List validation to code review checklist | Dev (Amelia) | Immediate (Epic 2 onwards) | Every code review verifies File List matches actual git diff |
| P3 | Enforce Zod `.parse()` at all data boundaries | Dev (Amelia) | Ongoing | Every query function with Zod schema must call `.parse()` |
| P4 | Add accessibility checklist to story creation | SM (Bob) | Before Epic 2 stories | Every UI story includes explicit AC for focus-visible, aria-label, keyboard nav |

### Technical Debt

| # | Item | Owner | Priority |
|---|------|-------|----------|
| D1 | CSP headers still permissive (unsafe-eval, unsafe-inline) | Dev (Amelia) | HIGH — address in Story 2.6 |
| D2 | Bundle size budget increased to 200KB (from 150KB) | Dev (Amelia) | MEDIUM — monitor, evaluate tree-shaking |

### Documentation

| # | Item | Owner | Deadline |
|---|------|-------|----------|
| DOC1 | Update architecture.md with actual technology versions (Tailwind v4, Next.js 16, proxy.ts, PUBLISHABLE_KEY, Zod v4) | Architect (Winston) | Before Epic 2 starts |
| DOC2 | Document Next.js 16 proxy.ts patterns for route protection | Dev (Amelia) | Before Story 2.6 creation |

### Team Agreements

- All stories must include a "Technology Version Check" substep before implementation begins
- snake_case→camelCase transformation happens ONLY in `src/lib/{domain}/queries.ts` — nowhere else
- No Zod schema without `.parse()` call — schemas that exist but aren't used at runtime are bugs

---

## Epic 2 Preparation Tasks

### Critical (must complete before epic starts)

- [x] Research Next.js 16 `proxy.ts` route protection patterns — Owner: Dev (Amelia) ✅ 2026-02-04 → `research-nextjs16-proxy-route-protection.md`
- [x] Verify Supabase Auth MFA API current behavior — Owner: Dev (Amelia) ✅ 2026-02-04 → `research-supabase-mfa-api.md`
- [x] Update architecture.md technology versions — Owner: Architect (Winston) ✅ 2026-02-04 → 17 edits applied to `architecture.md`

### Parallel (can happen during early stories)

- [x] Establish auth testing patterns (mock Supabase Auth, test MFA) — Owner: QA (Dana/Murat) ✅ 2026-02-04 → `research-auth-testing-patterns.md`
- [x] Provision Upstash Redis for rate limiting — Owner: Jiraw (Project Lead) ✅ 2026-02-04 → `.env.local` configured

### Nice-to-have

- [x] Evaluate Sentry SDK tree-shaking to recover bundle budget — Owner: Dev (Amelia) ✅ 2026-02-04 → `research-sentry-bundle-optimization.md`

---

## Significant Change Detection

**Epic Update Required:** NO

No discoveries from Epic 1 fundamentally change Epic 2's plan. The authentication and access control approach remains sound. The proxy.ts research is a preparation task, not a plan change.

---

## Readiness Assessment

| Area | Status |
|------|--------|
| Testing & Quality | Confirmed — 96 tests, coverage thresholds met |
| Deployment | No blockers |
| Stakeholder Acceptance | Confirmed by Jiraw |
| Technical Health | No fragility concerns |
| Unresolved Blockers | None |

**Verdict:** Epic 1 is fully complete. Team is clear to proceed to Epic 2 after completing critical preparation tasks.

---

## Next Steps

1. Execute preparation tasks (critical items before Epic 2)
2. Review action items when creating Epic 2 stories
3. Begin Epic 2 with Story 2.1: Initial Super Admin Account & Login
4. Apply team agreements from this retrospective immediately

---

**Retrospective Status:** Complete
**Document saved:** `_bmad-output/implementation-artifacts/epic-1-retro-2026-02-04.md`
